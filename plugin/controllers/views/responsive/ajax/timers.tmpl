#filter WebSafe
#from urllib import quote
#from time import localtime, strftime
#from Plugins.Extensions.OpenWebif.local import tstrings
#from Plugins.Extensions.OpenWebif.vtiaddon import skinColor, MinTimerList
<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
	<div class="card">
		<div class="header">
			<div class="row clearfix">
				<div class="col-xs-12 col-sm-6">
					<h2><i class="material-icons material-icons-centered">alarm</i>$tstrings['timer']</h2>
				</div>
			</div>
			<ul class="header-dropdown m-r--5">
				<li>
				<li class="dropdown"><a href="#" onclick="lastcontenturl='';load_maincontent('ajax/timers'); return false;" ><i class="material-icons">autorenew</i></a>
				<a href="javascript:void(0);" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><i class="material-icons">more_vert</i></a>
					<ul class="dropdown-menu pull-right" id="timerbuttons">
						<li><a href="#addtimer" data-toggle="modal" data-target="#TimerModal" data-evid="" data-ref="" id="timerbutton0"  ><i class="material-icons material-icons-centered">alarm_add</i>Timer hinzufÃ¼gen</a></li>
						<li><a href="#" onclick="lastcontenturl='';cleanupTimer(); return false" ><i class="material-icons material-icons-centered">delete</i>Timer aufrÃ¤umen</a></li>
						<li><a href="#" ionclick="lastcontenturl='';load_maincontent('ajax/timers'); return false;" ><i class="material-icons material-icons-centered">autorenew</i>Timer neu Laden</a></li>
					</ul>
				</li>
			</ul>
		</div>
		<div class="body" >
			<div id="content_main" >
				<div id="tvcontentmain">
					<div id="timers">
						#for $timer in $timers
						<div id="$timer.begin-$timer.end">
							#set $sref=quote($timer.serviceref, safe=' ~@#$&()*!+=:;,.?/\'')
							#set $tname=quote($timer.name)
							<div class="card">
								<div class="header">
									<div class="row clearfix" style="margin-bottom:-20px;">
										<div class="col-xs-6">
											<h2><i class="material-icons material-icons-centered">alarm</i>$timer.servicename - $timer.name</h2>
										</div>
										<div class="col-xs-6">
											<ul class="header-dropdown m-r--5">
											'$sref', '$timer.begin', '$timer.end'
												<li><span role="button"><a href="#edittimer" data-toggle="modal" data-target="#TimerModal" data-ref="$sref" data-begin="$timer.begin" data-end="$timer.end" title="$tstrings['edit_timer']"><i class="material-icons material-icons-mg-right">edit</i></a></span></li>
												<li><span role="button"><a href="#" onClick="toggleTimerStatus('$sref', '$timer.begin', '$timer.end'); lastcontenturl=''; setTimeout(function(){load_maincontent('ajax/timers')}, 200); return false;"
												#if $timer.disabled
													title="$tstrings['enable_timer']"><i class="material-icons material-icons-mg-right">alarm_on</i></a></span></li>
												#else
													title="$tstrings['disable_timer']"><i class="material-icons material-icons-mg-right">alarm_off</i></a></span></li>
												#end if
												<li><span role="button"><a href="#" onClick="deleteTimer('$sref', '$timer.begin', '$timer.end', '$tname'); lastcontenturl=''; setTimeout(function(){load_maincontent('ajax/timers')}, 200); return false;" title="$tstrings['delete_timer']" ><i class="material-icons material-icons-mg-right">delete</i></a></span></li>
											</ul>
										</div>
									</div>
								</div>
								<div class="body">
									<div class="row clearfix" style="margin-bottom:-20px;">
										<div class="col-sm-5">
											<b>$tstrings[("day_" + (time.strftime("%w", time.localtime($timer.begin))))]</b>
											$timer.realbegin - $timer.realend
										</div>
										#if $timer.repeated != 0
										<div>
										$tstrings['every_timer']
										#set $flags=$timer.repeated
										#set $timerDays=[]
										#for $day in [$tstrings['monday'],$tstrings['tuesday'],$tstrings['wednesday'],$tstrings['thursday'],$tstrings['friday'],$tstrings['saturday'],$tstrings['sunday']]
											#if $flags&1
												$timerDays.append($day)
											#end if
											#set $flags = $flags >> 1
										#end for
										#echo ', '.join($timerDays)
										</div>
										#end if
										<div class="col-sm-5">
											$timer.description
										</div>
										<div class="col-sm-2" style="font-weight:bold;">
										#if $timer.disabled
											$tstrings['disabled']
										#elif $timer.state == 0
											$tstrings['waiting']
										#elif $timer.state == 2
											$tstrings['running']
										#elif $timer.state == 3
											$tstrings['finished']
										#end if
										</div>
									</div>
								</div>
							</div>
						</div>
						#end for
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">
var reloadTimers = true;
#raw
$(function() {
	if(!timeredit_initialized)
		$('#editTimerForm').load('ajax/edittimer');
});
#end raw
</script>
#end filter


<div id="content_main" class="ui-widget-content" style="min-height: 500px;">
	<div id="tvcontentmain">
		<div id="toolbar-header" class="ui-widget-header">
			<span id="toolbar">
				<span id="timerbuttons">
					<button id="timerbutton0" onclick="addTimer(); return false">$tstrings['add_timer']</button>
					<button id="timerbutton1" onclick="cleanupTimer(); return false">$tstrings['cleanup_timer']</button>
					<button id="timerbutton2" onclick="lastcontenturl='';load_maincontent('ajax/timers'); return false;">$tstrings['refresh_timer']</button>
				</span>
			</span>
		</div>

		<div id="timers">
		#for $timer in $timers
			<div class="tm_row ui-widget-content ui-state-default" id="$timer.begin-$timer.end">
				<div class="t_buttons tm_buttons">
						<div>
						#set $sref=quote($timer.serviceref, safe=' ~@#$&()*!+=:;,.?/\'')
						#set $tname=quote($timer.name)
						<a href='#' onClick="editTimer('$sref', '$timer.begin', '$timer.end');" title="$tstrings['edit_timer']"><div><i class="fa fa-edit"></i></div></a>
						<a href='#' onClick="deleteTimer('$sref', '$timer.begin', '$timer.end', '$tname');" title="$tstrings['delete_timer']"><div><i class="fa fa-trash-o"></i></div></a>
						<a href='#' onClick="toggleTimerStatus('$sref', '$timer.begin', '$timer.end');" 
						#if $timer.disabled
						title="$tstrings['enable_timer']"><div id='img-$timer.begin-$timer.end'><i data-ref="$sref" class="fa fa-square-o">
						#else
						title="$tstrings['disable_timer']"><div id='img-$timer.begin-$timer.end'><i data-ref="$sref" class="fa fa-check-square-o">
						#end if
						</i></div></a>
						</div>
					</div>
				<div class="tm_text">
					<div>
						<div class="tm_title">
							$timer.name
						</div>
						$tstrings[("day_" + (time.strftime("%w", time.localtime($timer.begin))))]
						$timer.realbegin - $timer.realend
						#if $timer.repeated != 0
							<div>
								$tstrings['every_timer']
							#set $flags=$timer.repeated
							#set $timerDays=[]
							#for $day in [$tstrings['monday'],$tstrings['tuesday'],$tstrings['wednesday'],$tstrings['thursday'],$tstrings['friday'],$tstrings['saturday'],$tstrings['sunday']]
								#if $flags&1
									$timerDays.append($day)
								#end if
								#set $flags = $flags >> 1
							#end for
							#echo ', '.join($timerDays)
							</div>
						#end if
						<div style="font-weight: bold;">
							$timer.servicename
						</div>
					</div>
					<div>
						$timer.description
					</div>
					<div>
						<span class="tm_desc" style="font-weight: bold;">
							#if $timer.disabled
								$tstrings['disabled']
							#elif $timer.state == 0
								$tstrings['waiting']
							#elif $timer.state == 2
								$tstrings['running']
							#elif $timer.state == 3
								$tstrings['finished']
							#end if
						</span>
					</div>
				</div>
				<div style="clear: both;"></div>
			</div>
		#end for
		</div>
	</div>
</div>
<script type="text/javascript">
#raw
var reloadTimers = true;
$(function() {
	setTMHover();
	$('#timerbuttons').buttonset();
	if(!timeredit_initialized)
		$('#editTimerForm').load('ajax/edittimer');
	$('#timers').scroll(function() {
		SetLSValue('TimerListOffset',$('#timers').scrollTop());
	});
	$('#timers').scrollTop(GetLSValue('TimerListOffset',0));
});
#end raw
</script>
#end filter
